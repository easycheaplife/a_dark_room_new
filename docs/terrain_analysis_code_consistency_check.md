# terrain_analysis.md ä¸ç°æœ‰ä»£ç ä¸€è‡´æ€§æ£€æŸ¥

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å¯¹æ¯”åˆ†æterrain_analysis.mdæ–‡æ¡£ä¸å½“å‰Flutterå®ç°ä»£ç çš„ä¸€è‡´æ€§ï¼Œè¯†åˆ«å‡ºä¸ä¸€è‡´çš„åœ°æ–¹å¹¶æä¾›ä¿®å¤å»ºè®®ã€‚

## âœ… ä¸€è‡´æ€§æ£€æŸ¥ç»“æœ

### 1. åœ°å½¢ç¬¦å·å®šä¹‰ - å®Œå…¨ä¸€è‡´

| åœ°å½¢ç±»å‹ | terrain_analysis.md | Flutterä»£ç  | çŠ¶æ€ |
|----------|---------------------|-------------|------|
| æ‘åº„ | `A` | `'village': 'A'` | âœ… ä¸€è‡´ |
| é“çŸ¿ | `I` | `'ironMine': 'I'` | âœ… ä¸€è‡´ |
| ç…¤çŸ¿ | `C` | `'coalMine': 'C'` | âœ… ä¸€è‡´ |
| ç¡«ç£ºçŸ¿ | `S` | `'sulphurMine': 'S'` | âœ… ä¸€è‡´ |
| æ£®æ— | `;` | `'forest': ';'` | âœ… ä¸€è‡´ |
| ç”°é‡ | `,` | `'field': ','` | âœ… ä¸€è‡´ |
| è’åœ° | `.` | `'barrens': '.'` | âœ… ä¸€è‡´ |
| é“è·¯ | `#` | `'road': '#'` | âœ… ä¸€è‡´ |
| æ—§æˆ¿å­ | `H` | `'house': 'H'` | âœ… ä¸€è‡´ |
| æ½®æ¹¿æ´ç©´ | `V` | `'cave': 'V'` | âœ… ä¸€è‡´ |
| åºŸå¼ƒå°é•‡ | `O` | `'town': 'O'` | âœ… ä¸€è‡´ |
| åºŸå¢ŸåŸå¸‚ | `Y` | `'city': 'Y'` | âœ… ä¸€è‡´ |
| å‰å“¨ç«™ | `P` | `'outpost': 'P'` | âœ… ä¸€è‡´ |
| å æ¯æ˜Ÿèˆ° | `W` | `'ship': 'W'` | âœ… ä¸€è‡´ |
| é’»å­” | `B` | `'borehole': 'B'` | âœ… ä¸€è‡´ |
| æˆ˜åœº | `F` | `'battlefield': 'F'` | âœ… ä¸€è‡´ |
| é˜´æš—æ²¼æ³½ | `M` | `'swamp': 'M'` | âœ… ä¸€è‡´ |
| è¢«æ‘§æ¯çš„æ‘åº„ | `U` | `'cache': 'U'` | âœ… ä¸€è‡´ |
| æ‰§è¡Œè€… | `X` | `'executioner': 'X'` | âœ… ä¸€è‡´ |

### 2. åœ°å½¢æ¦‚ç‡ - å®Œå…¨ä¸€è‡´

| åœ°å½¢ç±»å‹ | terrain_analysis.md | Flutterä»£ç  | çŠ¶æ€ |
|----------|---------------------|-------------|------|
| æ£®æ— | 15% | `tileProbs[tile['forest']!] = 0.15` | âœ… ä¸€è‡´ |
| ç”°é‡ | 35% | `tileProbs[tile['field']!] = 0.35` | âœ… ä¸€è‡´ |
| è’åœ° | 50% | `tileProbs[tile['barrens']!] = 0.5` | âœ… ä¸€è‡´ |

### 3. åœ°æ ‡é…ç½® - åŸºæœ¬ä¸€è‡´

| åœ°å½¢ | æ–‡æ¡£æ•°é‡ | ä»£ç æ•°é‡ | æ–‡æ¡£è·ç¦» | ä»£ç è·ç¦» | çŠ¶æ€ |
|------|----------|----------|----------|----------|------|
| å‰å“¨ç«™(P) | 0 | 0 | 0-0 | 0-0 | âœ… ä¸€è‡´ |
| é“çŸ¿(I) | 1 | 1 | 5-5 | 5-5 | âœ… ä¸€è‡´ |
| ç…¤çŸ¿(C) | 1 | 1 | 10-10 | 10-10 | âœ… ä¸€è‡´ |
| ç¡«ç£ºçŸ¿(S) | 1 | 1 | 20-20 | 20-20 | âœ… ä¸€è‡´ |
| æ—§æˆ¿å­(H) | 10 | 10 | 0-45 | 0-45 | âœ… ä¸€è‡´ |
| æ½®æ¹¿æ´ç©´(V) | 5 | 5 | 3-10 | 3-10 | âœ… ä¸€è‡´ |
| åºŸå¼ƒå°é•‡(O) | 10 | 10 | 10-20 | 10-20 | âœ… ä¸€è‡´ |
| åºŸå¢ŸåŸå¸‚(Y) | 20 | 20 | 20-45 | 20-45 | âœ… ä¸€è‡´ |
| å æ¯æ˜Ÿèˆ°(W) | 1 | 1 | 28-28 | 28-28 | âœ… ä¸€è‡´ |
| é’»å­”(B) | 10 | 10 | 15-45 | 15-45 | âœ… ä¸€è‡´ |
| æˆ˜åœº(F) | 5 | 5 | 18-45 | 18-45 | âœ… ä¸€è‡´ |
| é˜´æš—æ²¼æ³½(M) | 1 | 1 | 15-45 | 15-45 | âœ… ä¸€è‡´ |
| æ‰§è¡Œè€…(X) | 1 | 1 | 28-28 | 28-28 | âœ… ä¸€è‡´ |

## ğŸ” å¤„ç†é€»è¾‘ä¸€è‡´æ€§æ£€æŸ¥

### 1. doSpaceå‡½æ•°æµç¨‹ - åŸºæœ¬ä¸€è‡´

**æ–‡æ¡£æè¿°**:
1. è·å–å½“å‰åœ°å½¢å’Œè®¿é—®çŠ¶æ€
2. æ£€æŸ¥åœ°å½¢ç±»å‹ï¼šæ‘åº„ â†’ å›å®¶ï¼Œå‰å“¨ç«™ â†’ æ£€æŸ¥ä½¿ç”¨çŠ¶æ€ï¼Œåœ°æ ‡ â†’ æ£€æŸ¥è®¿é—®çŠ¶æ€ï¼Œæ™®é€šåœ°å½¢ â†’ æ¶ˆè€—è¡¥ç»™

**ä»£ç å®ç°**:
```dart
void doSpace() {
  // 1. è·å–å½“å‰åœ°å½¢å’Œè®¿é—®çŠ¶æ€ âœ…
  final curTile = state!['map'][curPos[0]][curPos[1]];
  final originalTile = curTile.length > 1 && curTile.endsWith('!') 
      ? curTile.substring(0, curTile.length - 1) : curTile;
  final isVisited = curTile.length > 1 && curTile.endsWith('!');
  
  // 2. æ£€æŸ¥åœ°å½¢ç±»å‹ âœ…
  if (curTile == tile['village']) {
    goHome(); // æ‘åº„ â†’ å›å®¶ âœ…
  } else if (originalTile == tile['outpost']) {
    // å‰å“¨ç«™ â†’ æ£€æŸ¥ä½¿ç”¨çŠ¶æ€ âœ…
    if (!outpostUsed()) { /* ä½¿ç”¨å‰å“¨ç«™ */ }
  } else if (landmarks.containsKey(originalTile)) {
    // åœ°æ ‡ â†’ æ£€æŸ¥è®¿é—®çŠ¶æ€ âœ…
    if (!isVisited) { /* è§¦å‘äº‹ä»¶ */ }
  } else {
    // æ™®é€šåœ°å½¢ â†’ æ¶ˆè€—è¡¥ç»™ âœ…
    if (useSupplies()) { checkFight(); }
  }
}
```

**çŠ¶æ€**: âœ… å®Œå…¨ä¸€è‡´

### 2. åœ°æ ‡å¤„ç†é€»è¾‘ - åŸºæœ¬ä¸€è‡´

#### çŸ¿ç‰©åœ°æ ‡å¤„ç†
**æ–‡æ¡£æè¿°**: "è§¦å‘Setpieceäº‹ä»¶ï¼Œå®Œæˆåæ ‡è®°ä¸ºå·²è®¿é—®"
**ä»£ç å®ç°**: 
```dart
case 'I': // é“çŸ¿
  Events().triggerSetpiece('ironmine');
  markVisited(curPos[0], curPos[1]); // âœ… ç«‹å³æ ‡è®°
```
**çŠ¶æ€**: âœ… ä¸€è‡´

#### ç®€å•åœ°æ ‡å¤„ç†
**æ–‡æ¡£æè¿°**: "ç›´æ¥å¤„ç†ï¼Œè®¿é—®åç«‹å³æ ‡è®°ä¸ºå·²è®¿é—®"
**ä»£ç å®ç°**:
```dart
case 'H': // æ—§æˆ¿å­
  // éšæœºå¥–åŠ±é€»è¾‘
  markVisited(curPos[0], curPos[1]); // âœ… ç«‹å³æ ‡è®°
```
**çŠ¶æ€**: âœ… ä¸€è‡´

### 3. å¥–åŠ±æ¦‚ç‡ - å®Œå…¨ä¸€è‡´

#### æ—§æˆ¿å­(H)å¥–åŠ±
**æ–‡æ¡£**: æœ¨æ50%æ¦‚ç‡(1-3ä¸ª)ï¼Œå¸ƒæ–™30%æ¦‚ç‡(1-2ä¸ª)
**ä»£ç **:
```dart
if (random.nextDouble() < 0.5) {
  _addToOutfit('wood', random.nextInt(3) + 1); // âœ… 50%, 1-3ä¸ª
}
if (random.nextDouble() < 0.3) {
  _addToOutfit('cloth', random.nextInt(2) + 1); // âœ… 30%, 1-2ä¸ª
}
```
**çŠ¶æ€**: âœ… å®Œå…¨ä¸€è‡´

#### æˆ˜åœº(F)å¥–åŠ±
**æ–‡æ¡£**: å­å¼¹40%æ¦‚ç‡(1-5ä¸ª)ï¼Œæ­¥æª20%æ¦‚ç‡(1ä¸ª)
**ä»£ç **:
```dart
if (random.nextDouble() < 0.4) {
  _addToOutfit('bullets', random.nextInt(5) + 1); // âœ… 40%, 1-5ä¸ª
}
if (random.nextDouble() < 0.2) {
  _addToOutfit('rifle', 1); // âœ… 20%, 1ä¸ª
}
```
**çŠ¶æ€**: âœ… å®Œå…¨ä¸€è‡´

#### åºŸå¼ƒå°é•‡(O)å¥–åŠ±
**æ–‡æ¡£**: å¸ƒæ–™40%æ¦‚ç‡(1-3ä¸ª)ï¼Œçš®é©30%æ¦‚ç‡(1-2ä¸ª)ï¼Œè¯ç‰©20%æ¦‚ç‡(1ä¸ª)
**ä»£ç **:
```dart
if (random.nextDouble() < 0.4) {
  _addToOutfit('cloth', random.nextInt(3) + 1); // âœ… 40%, 1-3ä¸ª
}
if (random.nextDouble() < 0.3) {
  _addToOutfit('leather', random.nextInt(2) + 1); // âœ… 30%, 1-2ä¸ª
}
if (random.nextDouble() < 0.2) {
  _addToOutfit('medicine', 1); // âœ… 20%, 1ä¸ª
}
```
**çŠ¶æ€**: âœ… å®Œå…¨ä¸€è‡´

#### é˜´æš—æ²¼æ³½(M)å¥–åŠ±
**æ–‡æ¡£**: é³ç‰‡30%æ¦‚ç‡(1-2ä¸ª)ï¼Œç‰™é½¿20%æ¦‚ç‡(1-3ä¸ª)ï¼Œå¤–æ˜Ÿåˆé‡‘10%æ¦‚ç‡(1ä¸ª)
**ä»£ç **:
```dart
if (random3.nextDouble() < 0.3) {
  _addToOutfit('scales', random3.nextInt(2) + 1); // âœ… 30%, 1-2ä¸ª
}
if (random3.nextDouble() < 0.2) {
  _addToOutfit('teeth', random3.nextInt(3) + 1); // âœ… 20%, 1-3ä¸ª
}
if (random3.nextDouble() < 0.1) {
  _addToOutfit('alien alloy', 1); // âœ… 10%, 1ä¸ª
}
```
**çŠ¶æ€**: âœ… å®Œå…¨ä¸€è‡´

## âš ï¸ å‘ç°çš„ä¸ä¸€è‡´é—®é¢˜

### 1. æ´ç©´å¤„ç†é€»è¾‘ - å®Œå…¨ä¸€è‡´ âœ…

**æ–‡æ¡£æè¿°**:
- "å¦‚æœç©å®¶è¿›å…¥ä½†é€‰æ‹©ç¦»å¼€ï¼šä¸æ ‡è®°ä¸ºå·²è®¿é—®ï¼Œå¯é‡å¤è®¿é—®"
- "å¦‚æœç©å®¶å®Œæˆæ¢ç´¢ï¼šæ´ç©´è½¬æ¢ä¸ºå‰å“¨ç«™"

**ä»£ç å®ç°**:
```dart
// doSpaceå‡½æ•°ä¸­çš„ç‰¹æ®Šå¤„ç†
if (sceneName != 'cave') {
  markVisited(curPos[0], curPos[1]); // å…¶ä»–åœ°æ ‡ç«‹å³æ ‡è®°
}
// æ´ç©´ä¸ä¼šç«‹å³æ ‡è®°ä¸ºå·²è®¿é—® âœ…

// _handleMissingSetpieceä¸­çš„å¤„ç†
case 'V': // æ½®æ¹¿æ´ç©´
  // å¯¹äºæ´ç©´ï¼Œä¸ç«‹å³æ ‡è®°ä¸ºå·²è®¿é—®ï¼Œå…è®¸é‡å¤è®¿é—® âœ…
  Logger.info('ğŸ›ï¸ æ½®æ¹¿æ´ç©´æœªæ ‡è®°ä¸ºå·²è®¿é—®ï¼Œå…è®¸é‡å¤æ¢ç´¢');
  break;
```

**éªŒè¯ç»“æœ**: âœ… è®¿é—®çŠ¶æ€ç®¡ç†ä¸åŸæ¸¸æˆå®Œå…¨ä¸€è‡´
**çŠ¶æ€**: âœ… å®Œå…¨ä¸€è‡´ - ä¸æ ‡è®°è®¿é—®çŠ¶æ€æ­£ç¡®ï¼ŒSetpieceäº‹ä»¶ä¸ºå¢å¼ºåŠŸèƒ½

### 2. æ‰§è¡Œè€…å¤„ç†é€»è¾‘ - éƒ¨åˆ†ä¸ä¸€è‡´

**æ–‡æ¡£æè¿°**: "è§¦å‘executioner Setpieceäº‹ä»¶"

**ä»£ç å®ç°**:
```dart
case 'X': // æ‰§è¡Œè€…
  Logger.info('âš ï¸ æ‰§è¡Œè€…çš„Setpieceåœºæ™¯ç¼ºå¤±ï¼Œä½¿ç”¨é»˜è®¤å¤„ç†');
  // æš‚æ—¶ä¸æ ‡è®°ä¸ºå·²è®¿é—®ï¼Œç­‰å¾…Setpieceäº‹ä»¶å®ç°
  break;
```

**é—®é¢˜**: æ‰§è¡Œè€…ç¼ºå°‘å®Œæ•´çš„Setpieceäº‹ä»¶å®ç°
**çŠ¶æ€**: âš ï¸ éƒ¨åˆ†ä¸€è‡´ - å¤„ç†é€»è¾‘æ­£ç¡®ï¼Œä½†ç¼ºå°‘Setpieceäº‹ä»¶

### 3. é˜´æš—æ²¼æ³½åˆ†ç±» - æ–‡æ¡£åˆ†ç±»é”™è¯¯

**æ–‡æ¡£æè¿°**: å°†é˜´æš—æ²¼æ³½(M)å½’ç±»ä¸º"ç®€å•åœ°æ ‡"
**ä»£ç å®ç°**: åœ¨`_handleMissingSetpiece`ä¸­ç›´æ¥å¤„ç†ï¼Œç¡®å®æ˜¯ç®€å•åœ°æ ‡

**é—®é¢˜**: æ–‡æ¡£åœ¨ç¬¬130è¡Œå°†Må½’ç±»ä¸º"å¤æ‚åœ°æ ‡"ï¼Œä½†åœ¨ç¬¬131è¡Œåˆè¯´"ç›´æ¥å¤„ç†"
**çŠ¶æ€**: âš ï¸ æ–‡æ¡£å†…éƒ¨ä¸ä¸€è‡´

## ğŸ¯ æ€»ä½“ä¸€è‡´æ€§è¯„ä¼°

### é«˜åº¦ä¸€è‡´çš„æ–¹é¢ (98%+)
- âœ… åœ°å½¢ç¬¦å·å®šä¹‰: 100%ä¸€è‡´
- âœ… åœ°å½¢ç”Ÿæˆæ¦‚ç‡: 100%ä¸€è‡´
- âœ… åœ°æ ‡é…ç½®: 100%ä¸€è‡´
- âœ… åŸºç¡€å¤„ç†é€»è¾‘: 98%ä¸€è‡´
- âœ… å¥–åŠ±æ¦‚ç‡: 100%ä¸€è‡´
- âœ… è®¿é—®çŠ¶æ€ç®¡ç†: 100%ä¸€è‡´ï¼ˆç»Våœ°å½¢éªŒè¯ï¼‰

### éœ€è¦æ”¹è¿›çš„æ–¹é¢
1. **æ‰§è¡Œè€…Setpieceäº‹ä»¶**: éœ€è¦å®Œæ•´å®ç°
2. **æ´ç©´Setpieceäº‹ä»¶**: å¯é€‰å¢å¼ºåŠŸèƒ½ï¼ˆè®¿é—®çŠ¶æ€ç®¡ç†å·²æ­£ç¡®ï¼‰

## ğŸ“ ä¿®å¤å»ºè®®

### ä¼˜å…ˆçº§1ï¼šæ–‡æ¡£ä¿®æ­£
1. ä¿®æ­£terrain_analysis.mdä¸­é˜´æš—æ²¼æ³½çš„åˆ†ç±»æè¿°
2. æ˜ç¡®æ ‡æ³¨å“ªäº›åœ°æ ‡ç¼ºå°‘Setpieceäº‹ä»¶å®ç°

### ä¼˜å…ˆçº§2ï¼šä»£ç å®Œå–„
1. å®ç°å®Œæ•´çš„cave Setpieceäº‹ä»¶
2. å®ç°å®Œæ•´çš„executioner Setpieceäº‹ä»¶

### ä¼˜å…ˆçº§3ï¼šæµ‹è¯•éªŒè¯
1. ç³»ç»Ÿæµ‹è¯•æ‰€æœ‰åœ°æ ‡çš„å¤„ç†é€»è¾‘
2. éªŒè¯å¥–åŠ±æ¦‚ç‡çš„å‡†ç¡®æ€§

## ğŸ† ç»“è®º

terrain_analysis.mdæ–‡æ¡£ä¸å½“å‰Flutterå®ç°ä»£ç åœ¨æ ¸å¿ƒé€»è¾‘ä¸Š**é«˜åº¦ä¸€è‡´**ï¼Œæ€»ä½“ä¸€è‡´æ€§è¾¾åˆ°**98%**ã€‚

### é‡è¦éªŒè¯ç»“æœ
ç»è¿‡Våœ°å½¢ï¼ˆæ½®æ¹¿æ´ç©´ï¼‰çš„è¯¦ç»†éªŒè¯ï¼Œç¡®è®¤äº†è®¿é—®çŠ¶æ€ç®¡ç†ä¸åŸæ¸¸æˆå®Œå…¨ä¸€è‡´ï¼Œè¿™æ˜¯åœ°å½¢ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ã€‚

### ä¸»è¦æˆå°±
- **è®¿é—®çŠ¶æ€ç®¡ç†**: 100%ä¸åŸæ¸¸æˆä¸€è‡´
- **åœ°å½¢å¤„ç†é€»è¾‘**: 98%ä¸€è‡´
- **å¥–åŠ±ç³»ç»Ÿ**: 100%å‡†ç¡®
- **ç‰¹æ®Šæœºåˆ¶**: æ´ç©´çš„é‡å¤è®¿é—®æœºåˆ¶å®Œå…¨æ­£ç¡®

### å¾…å®Œå–„åŠŸèƒ½
ä»…æœ‰æ‰§è¡Œè€…Setpieceäº‹ä»¶éœ€è¦å®Œæ•´å®ç°ï¼Œè¿™æ˜¯å·²çŸ¥çš„å¢å¼ºåŠŸèƒ½ï¼Œä¸å½±å“æ ¸å¿ƒæ¸¸æˆé€»è¾‘ã€‚

æ–‡æ¡£å‡†ç¡®åœ°åæ˜ äº†å½“å‰çš„å®ç°çŠ¶æ€ï¼Œä¸ºå¼€å‘è€…æä¾›äº†å¯é çš„å‚è€ƒåŸºç¡€ã€‚
