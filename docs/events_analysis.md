# A Dark Room 事件系统分析

## 事件系统概述

A Dark Room的事件系统是游戏的核心机制之一，为玩家提供随机的故事情节、战斗遭遇和资源获取机会。事件系统分为几个主要类别：

## 事件分类

### 1. 全局事件 (Global Events)
- **触发条件**: 游戏进行中随机触发
- **特点**: 不依赖特定场景或建筑
- **频率**: 较低，提供重要的故事推进

### 2. 房间事件 (Room Events)
- **触发条件**: 在房间场景中
- **特点**: 通常与火堆、建造者相关
- **频率**: 中等，推进早期游戏进程

### 3. 外部事件 (Outside Events)
- **触发条件**: 在外部场景中，有村庄建筑
- **特点**: 与村庄发展、资源管理相关
- **频率**: 较高，提供持续的游戏内容

### 4. 世界地图事件 (World Events)
- **触发条件**: 在世界地图探索中
- **特点**: 战斗、探索、发现新地点
- **频率**: 探索时触发

## 主要事件类型

### 故事事件
1. **神秘访客**
   - 描述: 一个神秘的人物来到火堆旁
   - 选择: 欢迎/忽视
   - 结果: 可能获得资源或信息

2. **商人到访**
   - 描述: 商人带着货物前来交易
   - 选择: 交易/拒绝
   - 结果: 资源交换

3. **流浪者求助**
   - 描述: 受伤的流浪者寻求帮助
   - 选择: 帮助/拒绝
   - 结果: 消耗资源但可能获得回报

### 战斗事件
1. **野兽袭击**
   - 敌人: 各种野生动物
   - 战斗机制: 回合制战斗
   - 奖励: 肉类、毛皮

2. **盗贼入侵**
   - 敌人: 人类盗贼
   - 战斗机制: 可能偷取资源
   - 奖励: 武器、工具

3. **异形遭遇**
   - 敌人: 后期的外星生物
   - 战斗机制: 高难度战斗
   - 奖励: 稀有材料

### 发现事件
1. **资源发现**
   - 描述: 发现隐藏的资源点
   - 选择: 开采/忽略
   - 结果: 获得各种资源

2. **建筑发现**
   - 描述: 发现废弃的建筑
   - 选择: 探索/离开
   - 结果: 可能获得工具或遭遇危险

## 事件结构

每个事件包含以下基本结构：

```dart
{
  'title': '事件标题',
  'isAvailable': () => bool, // 可用性检查函数
  'scenes': {
    'start': {
      'text': ['事件描述文本'],
      'notification': '通知文本',
      'buttons': {
        'option1': {
          'text': '选择1',
          'nextScene': 'scene1',
          'cost': {'wood': 5}, // 可选的消耗
          'reward': {'meat': 3}, // 可选的奖励
        },
        'option2': {
          'text': '选择2',
          'nextScene': 'scene2',
        }
      }
    },
    'scene1': {
      'text': ['结果描述'],
      'reward': {'fur': 2},
      'buttons': {
        'leave': {
          'text': '离开',
          'nextScene': 'end'
        }
      }
    }
  }
}
```

## 战斗事件结构

战斗事件有特殊的结构：

```dart
{
  'title': '战斗事件标题',
  'scenes': {
    'start': {
      'combat': true,
      'enemy': '敌人名称',
      'health': 20,
      'damage': 3,
      'hit': 0.8, // 命中率
      'attackDelay': 2, // 攻击间隔(秒)
      'loot': {
        'meat': [1, 3], // 最小值, 最大值
        'fur': [0, 2]
      }
    }
  }
}
```

## 事件触发机制

1. **时间触发**: 每3-6分钟随机触发一个事件
2. **条件触发**: 满足特定条件时触发
3. **位置触发**: 在特定场景中触发
4. **进度触发**: 游戏进度达到某个阶段时触发

## 事件影响

事件可能产生以下影响：
- 资源变化 (增加/减少)
- 建筑解锁
- 新区域开放
- 角色状态变化
- 故事情节推进

## 本地化支持

所有事件文本都支持多语言，通过语言文件进行翻译：
- 事件标题
- 描述文本
- 按钮文本
- 通知消息

## 已实现的事件列表

### 全局事件 (GlobalEvents)
1. **神秘陌生人** - 提供资源奖励
2. **游牧部落** - 毛皮换取稀有物品
3. **病人** - 药品换取奖励
4. **拾荒者** - 木材换取金属
5. **乞丐** - 食物换取护身符
6. **小偷** - 防盗或损失资源

### 房间事件 (RoomEvents)
1. **守火人** - 解锁建造者
2. **建造者** - 建造者技能提升
3. **流浪猫** - 肉类换取护身符
4. **受伤的人** - 布料换取奖励
5. **陌生人** - 木材换取物品

### 外部事件 (OutsideEvents)
1. **商队** - 贸易或战斗选择
2. **袭击者** - 强制战斗
3. **野兽** - 战斗或躲藏选择
4. **商人** - 购买药品或武器
5. **难民** - 接受增加人口
6. **侦察兵** - 调查获得物资

### 世界地图事件 (WorldEvents)
#### 第一层 (距离 0-10)
1. **松鼠** - 基础战斗
2. **兔子** - 基础战斗
3. **狐狸** - 基础战斗
4. **狼** - 中等战斗
5. **土匪** - 中等战斗

#### 第二层 (距离 10-20)
1. **熊** - 高级战斗
2. **野猫** - 高级战斗
3. **土匪团伙** - 高级战斗
4. **拾荒者** - 高级战斗
5. **疯子** - 高级战斗

#### 第三层 (距离 20+)
1. **野兽** - 顶级战斗
2. **士兵** - 远程战斗
3. **外星人** - 顶级战斗
4. **变异体** - 顶级战斗
5. **战团** - 顶级战斗

## 实现特点

1. **完整的事件系统** - 包含故事事件和战斗事件
2. **资源管理** - 成本检查和奖励分配
3. **条件触发** - 基于游戏状态的事件可用性
4. **分层难度** - 根据探索距离调整敌人强度
5. **丰富的战利品** - 多样化的奖励机制
6. **中文本地化** - 所有文本都已翻译为中文
