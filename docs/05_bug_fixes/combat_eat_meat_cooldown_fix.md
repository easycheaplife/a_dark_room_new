# æˆ˜æ–—ä¸­åƒè‚‰å†·å´æ—¶é—´ä¿®å¤

**åˆ›å»ºæ—¥æœŸ**: 2025-01-27  
**æ›´æ–°æ—¥æœŸ**: 2025-01-27  
**é—®é¢˜ç±»å‹**: æ¸¸æˆæœºåˆ¶ä¿®å¤  
**ä¼˜å…ˆçº§**: é«˜  
**çŠ¶æ€**: å·²å®Œæˆ

## é—®é¢˜æè¿°

### ç”¨æˆ·åé¦ˆ
ç”¨æˆ·åæ˜ "æˆ˜æ–—ä¸­çš„åƒè‚‰æ²¡æœ‰å†·å´æ—¶é—´ä¹Ÿæ²¡æœ‰è¯»è¿›åº¦æ¡"ï¼Œå¯ä»¥è¿ç»­ç‚¹å‡»åƒè‚‰æŒ‰é’®ï¼Œæ²¡æœ‰5ç§’å†·å´é™åˆ¶ã€‚

### é—®é¢˜åˆ†æ
æˆ˜æ–—ä¸­çš„åƒè‚‰æŒ‰é’®åº”è¯¥æœ‰5ç§’å†·å´æ—¶é—´ï¼ˆå‚è€ƒåŸæ¸¸æˆEvents._EAT_COOLDOWNï¼‰ï¼Œä½†å®é™…ä¸Šå¯ä»¥è¿ç»­ç‚¹å‡»ï¼Œè¿åäº†æ¸¸æˆå¹³è¡¡æ€§ã€‚

## æ ¹æœ¬åŸå› 

### é—®é¢˜å®šä½
ProgressButtonä½¿ç”¨åŠ¨æ€æ–‡æœ¬ä½œä¸ºè¿›åº¦è·Ÿè¸ªIDï¼Œå¯¼è‡´è¿›åº¦çŠ¶æ€ç®¡ç†å¤±æ•ˆï¼š

```dart
// é—®é¢˜ä»£ç 
String get _progressId => 'ProgressButton.${widget.text}';

// æˆ˜æ–—ä¸­åƒè‚‰æŒ‰é’®æ–‡æœ¬æ˜¯åŠ¨æ€çš„
text: '${Localization().translate('combat.eat_meat')} (${path.outfit['cured meat']})'
// ç»“æœï¼š'åƒè‚‰ (18)' -> 'åƒè‚‰ (17)' -> 'åƒè‚‰ (16)' ...
```

### é—®é¢˜æœºåˆ¶
1. æ¯æ¬¡åƒè‚‰åï¼Œç†è‚‰æ•°é‡å‡å°‘ï¼ŒæŒ‰é’®æ–‡æœ¬æ”¹å˜
2. æ–‡æœ¬æ”¹å˜å¯¼è‡´`_progressId`æ”¹å˜
3. ProgressManageræ— æ³•è·Ÿè¸ªåŒä¸€ä¸ªæŒ‰é’®çš„è¿›åº¦çŠ¶æ€
4. æ¯æ¬¡ç‚¹å‡»éƒ½è¢«è§†ä¸ºæ–°çš„æŒ‰é’®ï¼Œç»•è¿‡äº†å†·å´æœºåˆ¶

## è§£å†³æ–¹æ¡ˆ

### 1. æ·»åŠ å›ºå®šIDå‚æ•°
ä¸ºProgressButtonæ·»åŠ å¯é€‰çš„å›ºå®šIDå‚æ•°ï¼š

```dart
class ProgressButton extends StatefulWidget {
  // ... å…¶ä»–å‚æ•°
  final String? id; // å›ºå®šIDï¼Œç”¨äºè¿›åº¦è·Ÿè¸ª

  const ProgressButton({
    // ... å…¶ä»–å‚æ•°
    this.id, // å¯é€‰çš„å›ºå®šID
  });
}
```

### 2. ä¿®æ”¹è¿›åº¦IDç”Ÿæˆé€»è¾‘
ä½¿ç”¨å›ºå®šIDä¼˜å…ˆï¼Œæ–‡æœ¬ä½œä¸ºåå¤‡ï¼š

```dart
// ä¿®å¤åçš„ä»£ç 
String get _progressId => widget.id ?? 'ProgressButton.${widget.text}';
```

### 3. ä¸ºæˆ˜æ–—æŒ‰é’®è®¾ç½®å›ºå®šID
ä¸ºæ‰€æœ‰æˆ˜æ–—ä¸­çš„ç‰©å“æŒ‰é’®è®¾ç½®å›ºå®šIDï¼š

```dart
// æˆ˜æ–—ä¸­åƒè‚‰æŒ‰é’®
ProgressButton(
  text: '${Localization().translate('combat.eat_meat')} (${path.outfit['cured meat']})',
  onPressed: () => events.eatMeat(),
  progressDuration: GameConfig.eatCooldown * 1000,
  id: 'combat.eat_meat', // å›ºå®šIDï¼Œé¿å…å› æ–‡æœ¬å˜åŒ–å¯¼è‡´è¿›åº¦è·Ÿè¸ªå¤±æ•ˆ
),

// æˆ˜æ–—ä¸­ä½¿ç”¨è¯ç‰©æŒ‰é’®
ProgressButton(
  id: 'combat.use_medicine', // å›ºå®šID
),

// æˆ˜æ–—ä¸­ä½¿ç”¨å…´å¥‹å‰‚æŒ‰é’®
ProgressButton(
  id: 'combat.use_hypo', // å›ºå®šID
),
```

## ä¿®æ”¹çš„æ–‡ä»¶

### 1. lib/widgets/progress_button.dart
- æ·»åŠ `id`å‚æ•°åˆ°ProgressButtonç±»
- ä¿®æ”¹`_progressId`ç”Ÿæˆé€»è¾‘

### 2. lib/screens/combat_screen.dart
- ä¸ºæˆ˜æ–—ä¸­çš„åƒè‚‰æŒ‰é’®æ·»åŠ å›ºå®šID `'combat.eat_meat'`
- ä¸ºæˆ˜æ–—ä¸­çš„è¯ç‰©æŒ‰é’®æ·»åŠ å›ºå®šID `'combat.use_medicine'`
- ä¸ºæˆ˜æ–—ä¸­çš„å…´å¥‹å‰‚æŒ‰é’®æ·»åŠ å›ºå®šID `'combat.use_hypo'`

## æµ‹è¯•éªŒè¯

### æµ‹è¯•è¿‡ç¨‹
1. å¯åŠ¨æ¸¸æˆå¹¶è¿›å…¥æˆ˜æ–—
2. è¿ç»­ç‚¹å‡»æˆ˜æ–—ä¸­çš„åƒè‚‰æŒ‰é’®
3. è§‚å¯Ÿæ—¥å¿—è¾“å‡ºå’ŒæŒ‰é’®çŠ¶æ€

### æµ‹è¯•ç»“æœ
ä¿®å¤åçš„æ—¥å¿—æ˜¾ç¤ºå†·å´æœºåˆ¶æ­£å¸¸å·¥ä½œï¼š

```
[INFO] ğŸš€ ProgressButton started: åƒè‚‰ (18), duration: 5000ms
[INFO] âœ… Action executed immediately for combat.eat_meat
[INFO] âœ… ProgressManager.startProgress called for combat.eat_meat

// 5ç§’å
[INFO] âœ… ProgressManager: Progress combat.eat_meat completed
[INFO] âœ… Cooldown completed for combat.eat_meat

// ç¬¬äºŒæ¬¡ç‚¹å‡»
[INFO] ğŸš€ ProgressButton started: åƒè‚‰ (17), duration: 5000ms
[INFO] âœ… Action executed immediately for combat.eat_meat
[INFO] âœ… ProgressManager.startProgress called for combat.eat_meat
```

### éªŒè¯è¦ç‚¹
- âœ… æˆ˜æ–—ä¸­åƒè‚‰æœ‰5ç§’å†·å´æ—¶é—´
- âœ… åŠ¨ä½œç«‹å³æ‰§è¡Œï¼ˆè¡€é‡ç«‹å³æ¢å¤ï¼‰
- âœ… å†·å´æœŸé—´æŒ‰é’®æ­£ç¡®ç¦ç”¨
- âœ… ä½¿ç”¨å›ºå®šID `combat.eat_meat` è·Ÿè¸ªè¿›åº¦
- âœ… æ–‡æœ¬å˜åŒ–ä¸å½±å“è¿›åº¦è·Ÿè¸ª

## è®¾è®¡å¯¹æ¯”

### ä¿®å¤å‰ vs ä¿®å¤å
| æ–¹é¢ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| è¿›åº¦ID | åŠ¨æ€æ–‡æœ¬ | å›ºå®šID |
| å†·å´æœºåˆ¶ | å¤±æ•ˆ | æ­£å¸¸ |
| è¿ç»­ç‚¹å‡» | å¯ä»¥ | è¢«é˜»æ­¢ |
| è¿›åº¦è·Ÿè¸ª | æ–­è£‚ | è¿ç»­ |

### ä¸åŸæ¸¸æˆå¯¹æ¯”
| åœºæ™¯ | åŸæ¸¸æˆ | ä¿®å¤å |
|------|--------|--------|
| æˆ˜æ–—ä¸­åƒè‚‰ | 5ç§’å†·å´ | 5ç§’å†·å´ âœ… |
| æˆ˜æ–—ç»“æŸåƒè‚‰ | æ— å†·å´ | æ— å†·å´ âœ… |
| ç«‹å³æ‰§è¡Œ | æ˜¯ | æ˜¯ âœ… |

## æŠ€æœ¯ç»†èŠ‚

### å‘åå…¼å®¹æ€§
- æ–°å¢çš„`id`å‚æ•°æ˜¯å¯é€‰çš„ï¼Œä¸å½±å“ç°æœ‰ä»£ç 
- æœªè®¾ç½®`id`æ—¶è‡ªåŠ¨ä½¿ç”¨æ–‡æœ¬ä½œä¸ºIDï¼Œä¿æŒåŸæœ‰è¡Œä¸º

### æ‰©å±•æ€§
- å…¶ä»–éœ€è¦å›ºå®šIDçš„ProgressButtonå¯ä»¥ä½¿ç”¨ç›¸åŒæ–¹æ¡ˆ
- ä¸ºæœªæ¥çš„åŠ¨æ€æ–‡æœ¬æŒ‰é’®æä¾›äº†è§£å†³æ–¹æ¡ˆ

## æ€»ç»“

è¿™æ¬¡ä¿®å¤è§£å†³äº†ä¸€ä¸ªå…³é”®çš„æ¸¸æˆå¹³è¡¡é—®é¢˜ã€‚é€šè¿‡ä¸ºProgressButtonæ·»åŠ å›ºå®šIDæ”¯æŒï¼Œç¡®ä¿äº†æˆ˜æ–—ä¸­ç‰©å“ä½¿ç”¨çš„å†·å´æœºåˆ¶æ­£å¸¸å·¥ä½œï¼Œç»´æŠ¤äº†æ¸¸æˆçš„å¹³è¡¡æ€§å’ŒåŸæ¸¸æˆçš„ä¸€è‡´æ€§ã€‚

ä¿®å¤åçš„ç³»ç»Ÿå®Œå…¨ç¬¦åˆåŸæ¸¸æˆè®¾è®¡ï¼š
- æˆ˜æ–—ä¸­åƒè‚‰æœ‰5ç§’å†·å´æ—¶é—´
- æˆ˜æ–—ç»“æŸååƒè‚‰æ— å†·å´æ—¶é—´  
- æ‰€æœ‰åŠ¨ä½œç«‹å³æ‰§è¡Œï¼Œè¿›åº¦æ¡åªæ˜¾ç¤ºå†·å´æ—¶é—´
