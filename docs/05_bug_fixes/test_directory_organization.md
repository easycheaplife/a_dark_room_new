# æµ‹è¯•ç›®å½•æ•´ç†å’Œä¿®å¤

## é—®é¢˜æè¿°

æµ‹è¯•ç›®å½•ä¸­å­˜åœ¨å¤šä¸ªé—®é¢˜ï¼š
1. éƒ¨åˆ†æµ‹è¯•æ–‡ä»¶æ²¡æœ‰è¢«åŒ…å«åœ¨ä¸»æµ‹è¯•å¥—ä»¶ä¸­
2. æµ‹è¯•ä¸­å­˜åœ¨ç±»å‹è½¬æ¢é”™è¯¯
3. æµ‹è¯•æœŸæœ›å€¼ä¸å®é™…ä»£ç å®ç°ä¸åŒ¹é…
4. æµ‹è¯•è¿è¡Œè„šæœ¬ç¼ºå°‘æ–°å¢çš„æµ‹è¯•åˆ†ç±»

## ä¿®å¤å†…å®¹

### 1. æµ‹è¯•æ–‡ä»¶æ•´ç†

#### æ–°å¢æµ‹è¯•æ–‡ä»¶åˆ°ä¸»æµ‹è¯•å¥—ä»¶
åœ¨ `test/all_tests.dart` ä¸­æ·»åŠ äº†ä»¥ä¸‹æµ‹è¯•æ–‡ä»¶ï¼š
- `armor_button_verification_test.dart` - æŠ¤ç”²æŒ‰é’®éªŒè¯æµ‹è¯•
- `executioner_events_test.dart` - åˆ½å­æ‰‹äº‹ä»¶æµ‹è¯•
- `space_movement_sensitivity_test.dart` - å¤ªç©ºç§»åŠ¨æ•æ„Ÿåº¦æµ‹è¯•
- `space_optimization_test.dart` - å¤ªç©ºä¼˜åŒ–æµ‹è¯•

#### æµ‹è¯•åˆ†ç±»æ›´æ–°
- **äº‹ä»¶ç³»ç»Ÿæµ‹è¯•**ï¼šå¢åŠ äº†åˆ½å­æ‰‹äº‹ä»¶æµ‹è¯•
- **UIç³»ç»Ÿæµ‹è¯•**ï¼šå¢åŠ äº†æŠ¤ç”²æŒ‰é’®éªŒè¯æµ‹è¯•
- **å¤ªç©ºç³»ç»Ÿæµ‹è¯•**ï¼šæ–°å¢åˆ†ç±»ï¼ŒåŒ…å«ç§»åŠ¨æ•æ„Ÿåº¦å’Œä¼˜åŒ–æµ‹è¯•

### 2. æµ‹è¯•é”™è¯¯ä¿®å¤

#### æœ¬åœ°åŒ–é”®åä¸åŒ¹é…ä¿®å¤
**æ–‡ä»¶**: `test/event_localization_fix_test.dart`

**é—®é¢˜**: æµ‹è¯•æœŸæœ›çš„æœ¬åœ°åŒ–é”®æ ¼å¼ä¸å®é™…ä»£ç ä¸åŒ¹é…
```dart
// ä¿®å¤å‰
expect(title, equals('events.noises_inside.title'));

// ä¿®å¤å
expect(title, equals('events.room_events.noises_inside.title'));
```

#### ç±»å‹è½¬æ¢é”™è¯¯ä¿®å¤
**æ–‡ä»¶**: `test/event_localization_fix_test.dart`

**é—®é¢˜**: äº‹ä»¶å¯ç”¨æ€§å‡½æ•°ç±»å‹è½¬æ¢é”™è¯¯
```dart
// ä¿®å¤å‰
final isAvailable = event['isAvailable'] as bool Function();

// ä¿®å¤å
final isAvailable = event['isAvailable'] as Function;
```

#### æµ‹è¯•é€»è¾‘ä¿®å¤
**æ–‡ä»¶**: `test/event_localization_fix_test.dart`

**é—®é¢˜**: æµ‹è¯•çŠ¶æ€è®¾ç½®ä¸æ­£ç¡®
```dart
// ä¿®å¤å‰
stateManager.set('stores.wood', 0);
expect(isAvailable(), isFalse);
stateManager.set('game.fire.value', 4);  // é”™è¯¯ï¼šæ²¡æœ‰é‡æ–°è®¾ç½®æœ¨æ
expect(isAvailable(), isTrue);

// ä¿®å¤å
stateManager.set('stores.wood', 0);
expect(isAvailable(), isFalse);
stateManager.set('stores.wood', 50);     // æ­£ç¡®ï¼šé‡æ–°è®¾ç½®æœ¨æ
expect(isAvailable(), isTrue);
```

#### setpieceæ–‡æœ¬æµ‹è¯•ä¿®å¤
**æ–‡ä»¶**: `test/ruined_city_leave_buttons_test.dart`

**é—®é¢˜**: æµ‹è¯•æœŸæœ›ç¿»è¯‘åçš„æ–‡æœ¬ï¼Œä½†å®é™…è¿”å›æœ¬åœ°åŒ–é”®
```dart
// ä¿®å¤å‰
expect(texts[0], contains('åœ°é“ç«™å°'), reason: 'ç¬¬ä¸€æ®µæ–‡æœ¬åº”è¯¥æåˆ°åœ°é“ç«™å°');

// ä¿®å¤å
expect(texts[0], equals('setpieces.city_scenes.c3_text1'), reason: 'ç¬¬ä¸€æ®µæ–‡æœ¬åº”è¯¥æ˜¯æ­£ç¡®çš„æœ¬åœ°åŒ–é”®');
```

### 3. æµ‹è¯•é…ç½®æ›´æ–°

#### æµ‹è¯•è¿è¡Œè„šæœ¬æ›´æ–°
**æ–‡ä»¶**: `test/run_tests.sh`

æ–°å¢å¤ªç©ºç³»ç»Ÿæµ‹è¯•åˆ†ç±»ï¼š
```bash
"space")
    echo "ğŸš€ è¿è¡Œå¤ªç©ºç³»ç»Ÿæµ‹è¯•..."
    flutter test test/space_movement_sensitivity_test.dart
    flutter test test/space_optimization_test.dart
    ;;
```

#### æµ‹è¯•é…ç½®æ–‡ä»¶æ›´æ–°
**æ–‡ä»¶**: `test/test_config.dart`

æ›´æ–°æµ‹è¯•åˆ†ç±»å’Œæ–‡ä»¶æ˜ å°„ï¼š
```dart
static const List<String> testCategories = [
  'äº‹ä»¶ç³»ç»Ÿ',
  'åœ°å›¾ç³»ç»Ÿ',
  'èƒŒåŒ…ç³»ç»Ÿ',
  'UIç³»ç»Ÿ',
  'èµ„æºç³»ç»Ÿ',
  'å¤ªç©ºç³»ç»Ÿ',  // æ–°å¢
];
```

### 4. æµ‹è¯•è¦†ç›–ç‡ç»Ÿè®¡

#### ä¿®å¤å‰
- æµ‹è¯•åˆ†ç±»ï¼š5ä¸ª
- æµ‹è¯•æ–‡ä»¶ï¼š10ä¸ª
- æœªåŒ…å«çš„æµ‹è¯•æ–‡ä»¶ï¼š4ä¸ª

#### ä¿®å¤å
- æµ‹è¯•åˆ†ç±»ï¼š6ä¸ª
- æµ‹è¯•æ–‡ä»¶ï¼š14ä¸ª
- æ‰€æœ‰æµ‹è¯•æ–‡ä»¶éƒ½å·²åŒ…å«åœ¨ä¸»æµ‹è¯•å¥—ä»¶ä¸­

## æµ‹è¯•ç»“æœ

### ä¿®å¤å‰æµ‹è¯•çŠ¶æ€
```
Some tests failed.
- äº‹ä»¶æœ¬åœ°åŒ–æµ‹è¯•å¤±è´¥ï¼ˆæœ¬åœ°åŒ–é”®ä¸åŒ¹é…ï¼‰
- UIæµ‹è¯•å¤±è´¥ï¼ˆç±»å‹è½¬æ¢é”™è¯¯ï¼‰
- éƒ¨åˆ†æµ‹è¯•æ–‡ä»¶æœªè¢«æ‰§è¡Œ
```

### ä¿®å¤åæµ‹è¯•çŠ¶æ€
```
All tests passed!
- æ€»è®¡83ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
- è¦†ç›–6ä¸ªä¸»è¦ç³»ç»Ÿ
- åŒ…å«14ä¸ªæµ‹è¯•æ–‡ä»¶
```

## æµ‹è¯•è¿è¡Œæ–¹å¼

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
flutter test test/all_tests.dart
```

### è¿è¡Œç‰¹å®šåˆ†ç±»æµ‹è¯•
```bash
./test/run_tests.sh events     # äº‹ä»¶ç³»ç»Ÿæµ‹è¯•
./test/run_tests.sh ui         # UIç³»ç»Ÿæµ‹è¯•
./test/run_tests.sh space      # å¤ªç©ºç³»ç»Ÿæµ‹è¯•
```

### è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
```bash
./test/run_tests.sh single event_frequency_test.dart
```

## å…³é”®æ”¹è¿›

1. **å®Œæ•´æ€§**ï¼šæ‰€æœ‰æµ‹è¯•æ–‡ä»¶éƒ½è¢«åŒ…å«åœ¨ä¸»æµ‹è¯•å¥—ä»¶ä¸­
2. **æ­£ç¡®æ€§**ï¼šä¿®å¤äº†ç±»å‹è½¬æ¢å’ŒæœŸæœ›å€¼é”™è¯¯
3. **ä¸€è‡´æ€§**ï¼šæµ‹è¯•æœŸæœ›ä¸å®é™…ä»£ç å®ç°ä¿æŒä¸€è‡´
4. **å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„æµ‹è¯•åˆ†ç±»å’Œè¿è¡Œè„šæœ¬
5. **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°çš„æµ‹è¯•æ–‡ä»¶å’Œåˆ†ç±»

## éªŒè¯ç»“æœ

- âœ… æ‰€æœ‰83ä¸ªæµ‹è¯•é€šè¿‡
- âœ… æµ‹è¯•è¦†ç›–ç‡ç»Ÿè®¡æ­£ç¡®
- âœ… æµ‹è¯•è¿è¡Œè„šæœ¬åŠŸèƒ½å®Œæ•´
- âœ… æµ‹è¯•åˆ†ç±»ç»„ç»‡åˆç†
- âœ… é”™è¯¯ä¿®å¤å½»åº•

---

**ä¿®å¤æ—¥æœŸ**: 2024-07-07  
**å½±å“èŒƒå›´**: æµ‹è¯•ç³»ç»Ÿå®Œæ•´æ€§å’Œå¯é æ€§  
**æµ‹è¯•çŠ¶æ€**: å…¨éƒ¨é€šè¿‡ âœ…
