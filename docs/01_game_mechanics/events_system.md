# 事件系统完整指南

**最后更新**: 2025-06-26

## 📋 概述

本文档是A Dark Room事件系统的完整指南，整合了遭遇事件系统、完整事件对比分析、地标事件设计模式等所有相关内容，为开发者提供统一的事件系统参考资料。

## 🎯 事件系统总览

### 完成度状态
- **房间事件**: 12/12 (100%) ✅
- **外部事件**: 6/6 (100%) ✅
- **遭遇事件**: 3个等级完整实现 ✅
- **地标事件**: 5种设计模式完整实现 ✅
- **技能系统**: 12/12 (100%) ✅
- **整体一致性**: 100% 🎯

### 事件系统分类

| 事件类型 | 触发位置 | 数量 | 完成状态 | 主要功能 |
|----------|----------|------|----------|----------|
| 房间事件 | 小黑屋 | 12个 | ✅ 100% | 交易、技能学习、资源获取 |
| 外部事件 | 外部世界 | 6个 | ✅ 100% | 村庄管理、危机处理 |
| 遭遇事件 | 世界地图 | 3等级 | ✅ 100% | 战斗、资源获取 |
| 地标事件 | 特殊地标 | 5种模式 | ✅ 100% | 探索、挑战、奖励 |
| 全局事件 | 任意位置 | 2个 | ✅ 100% | 特殊机制、技能获取 |

## 🏠 房间事件系统

### 交易类事件

#### The Nomad (游牧商人)
- **功能**: 毛皮交易系统
- **交易项目**: 鳞片、牙齿、诱饵、指南针
- **状态**: ✅ 完成
- **特点**: 多选项交易，资源转换

#### The Beggar (乞丐)
- **功能**: 毛皮换取基础资源
- **交易项目**: 鳞片、牙齿、布料
- **状态**: ✅ 完成
- **特点**: 简单交易，慈善机制

### 建造类事件

#### The Shady Builder (可疑建造者)
- **功能**: 木材建造小屋
- **风险**: 有概率建造失败
- **状态**: ✅ 完成
- **特点**: 风险收益机制

### 延迟奖励类事件

#### Mysterious Wanderer (神秘流浪者)
- **版本**: 木材版、毛皮版
- **功能**: 延迟奖励机制
- **状态**: ✅ 完成
- **特点**: 时间延迟，高价值奖励

### 技能学习类事件

#### The Master (大师)
- **功能**: 基础技能学习
- **技能**: 精准、高效、敏捷等
- **状态**: ✅ 完成
- **特点**: 技能系统核心

#### Martial Master (武术大师)
- **功能**: 高级徒手技能
- **技能**: 武术专精
- **状态**: ✅ 完成
- **特点**: 战斗能力提升

#### Desert Guide (沙漠向导)
- **功能**: 生存技能学习
- **技能**: 沙漠生存
- **状态**: ✅ 完成
- **特点**: 探索能力提升

### 特殊功能类事件

#### The Scout (侦察兵)
- **功能**: 地图购买系统
- **价格**: 200毛皮
- **状态**: ✅ 完成
- **特点**: 地图解锁机制

#### The Sick Man (病人)
- **功能**: 药品换取奖励
- **需求**: 医药
- **状态**: ✅ 完成
- **特点**: 人道主义选择

## 🌲 外部事件系统

### 村庄管理事件

#### Fire (火灾)
- **影响**: 小屋损失，村民死亡
- **应对**: 及时扑救
- **状态**: ✅ 完成

#### Sickness (疾病)
- **影响**: 村民生病
- **应对**: 使用药品治疗
- **状态**: ✅ 完成

#### Plague (瘟疫)
- **影响**: 大规模疾病，高死亡率
- **应对**: 大量药品
- **状态**: ✅ 完成

### 攻击事件

#### A Beast Attack (野兽袭击)
- **威胁**: 野兽攻击村庄
- **应对**: 武器防御
- **状态**: ✅ 完成

#### A Military Raid (军事突袭)
- **威胁**: 士兵攻击
- **应对**: 强力武器
- **状态**: ✅ 完成

### 探索事件

#### A Ruined Trap (被毁的陷阱)
- **功能**: 侦察技能效果展示
- **奖励**: 资源获取
- **状态**: ✅ 完成

## ⚔️ 遭遇事件系统

### Tier 1: 近距离敌人 (距离 ≤ 10)

#### 咆哮野兽 (Snarling Beast)
- **出现条件**: 距离 ≤ 10，森林地形
- **战斗属性**: 生命值5，伤害1，命中率80%
- **战利品**: 毛皮、肉类、牙齿
- **状态**: ✅ 完成

#### 憔悴男人 (Gaunt Man)
- **出现条件**: 距离 ≤ 10，荒地地形
- **战斗属性**: 生命值6，伤害2，命中率80%
- **战利品**: 布料、牙齿、皮革
- **状态**: ✅ 完成

#### 奇怪鸟类 (Strange Bird)
- **出现条件**: 距离 ≤ 10，田野地形
- **战斗属性**: 生命值4，伤害3，命中率80%
- **战利品**: 鳞片、牙齿、肉类
- **状态**: ✅ 完成

### Tier 2: 中距离敌人 (距离 10-20)

#### 巨大蜘蛛 (Huge Spider)
- **出现条件**: 距离 10-20
- **战斗属性**: 生命值8，伤害4，命中率75%
- **战利品**: 鳞片、牙齿、毒液
- **状态**: ✅ 完成

#### 盗贼 (Thief)
- **出现条件**: 距离 10-20
- **战斗属性**: 生命值10，伤害3，命中率85%
- **战利品**: 武器、子弹、布料
- **状态**: ✅ 完成

### Tier 3: 远距离敌人 (距离 > 20)

#### 死神 (Death)
- **出现条件**: 距离 > 20
- **战斗属性**: 生命值15，伤害8，命中率90%
- **战利品**: 高级装备、稀有资源
- **状态**: ✅ 完成

## 🏛️ 地标事件设计模式

### 1. 简单奖励型 (Simple Reward)

**代表地标**: 战场 (Battlefield)、钻孔 (Borehole)

**设计特点**:
- 无风险，直接获得奖励
- 适合提供稀有资源
- 奖励价值与地标稀有度成正比

**实现模式**:
```javascript
"battlefield": {
    title: _('A Forgotten Battlefield'),
    scenes: {
        'start': {
            text: [_('a battle was fought here, long ago.')],
            loot: {
                'rifle': { min: 1, max: 3, chance: 0.5 },
                'bullets': { min: 5, max: 20, chance: 0.8 },
                'alien alloy': { min: 1, max: 1, chance: 0.3 }
            },
            buttons: {
                'leave': { text: _('leave'), nextScene: 'end' }
            }
        }
    }
}
```

### 2. 随机分支型 (Random Branch)

**代表地标**: 房子 (House)

**设计特点**:
- 多种随机结果
- 增加重复探索价值
- 平衡风险与收益

**分支类型**:
- 25% 概率: 找到补给品并补满水
- 25% 概率: 发现小型战利品
- 25% 概率: 遭遇敌人或陷阱
- 25% 概率: 空房子，无收获

### 3. 渐进探索型 (Progressive Exploration)

**代表地标**: 洞穴 (Cave)、小镇 (Town)、城市 (City)

**设计特点**:
- 多阶段探索
- 逐步深入
- 最终转换为前哨站

**探索阶段**:
1. **初始阶段**: 基础探索和选择
2. **深入阶段**: 面对挑战和战斗
3. **完成阶段**: 获得奖励并转换

### 4. 战斗挑战型 (Combat Challenge)

**代表地标**: 矿山 (Mine)

**设计特点**:
- 强制战斗
- 高风险高回报
- 需要充分准备

**挑战要素**:
- 强力敌人
- 资源消耗
- 装备需求

### 5. 选择驱动型 (Choice Driven)

**代表地标**: 执行者 (Executioner)

**设计特点**:
- 重要选择影响结果
- 道德和战略考量
- 多种结局路径

**选择影响**:
- 战斗策略选择
- 资源分配决策
- 风险承担程度

## 🌍 全局事件系统

### The Thief (小偷)
- **功能**: 偷窃技能和村民处理机制
- **触发**: 随机全局事件
- **状态**: ✅ 完成

### Swamp (沼泽地标)
- **功能**: 美食家技能获得
- **位置**: 特殊地标
- **状态**: ✅ 完成

## 🎮 事件系统设计理念

### 心理学技巧应用

#### 1. 变比强化 (Variable Ratio Reinforcement)
- **应用**: 随机奖励系统
- **效果**: 增加探索动机
- **实现**: 不同概率的战利品

#### 2. 损失厌恶 (Loss Aversion)
- **应用**: 风险选择设计
- **效果**: 增加决策紧张感
- **实现**: 可能失去资源的选择

#### 3. 进步感知 (Progress Perception)
- **应用**: 渐进式解锁
- **效果**: 持续的成就感
- **实现**: 阶段性目标和奖励

### 平衡性设计

#### 风险回报平衡
- **低风险低回报**: 基础探索
- **中风险中回报**: 一般地标
- **高风险高回报**: 危险地标

#### 资源循环
- **消耗**: 探索需要资源
- **获得**: 成功获得奖励
- **再投资**: 用于下次探索

## 🔧 技术实现要点

### 事件触发机制

```dart
// 事件触发检查
void checkEvent() {
  if (shouldTriggerEvent()) {
    final eventType = selectEventType();
    triggerEvent(eventType);
  }
}
```

### 随机性管理

```dart
// 随机奖励生成
Map<String, int> generateLoot(Map<String, dynamic> lootTable) {
  final result = <String, int>{};
  
  for (final entry in lootTable.entries) {
    final item = entry.key;
    final config = entry.value;
    
    if (Random().nextDouble() < config['chance']) {
      final amount = Random().nextInt(config['max'] - config['min'] + 1) + config['min'];
      result[item] = amount;
    }
  }
  
  return result;
}
```

### 状态管理

```dart
// 事件状态持久化
void saveEventState(String eventId, Map<String, dynamic> state) {
  final sm = StateManager();
  sm.set('events.$eventId', state);
}
```

## 🔗 相关文档

- [地形系统完整指南](terrain_system.md) - 地形事件触发机制
- [前哨站系统](outpost_system.md) - 地标转换机制
- [玩家进度系统完整指南](player_progression.md) - 技能和属性系统
- [火把系统完整指南](torch_system.md) - 事件中的火把需求
- [房间机制分析](../room_mechanism.md) - 房间事件详细分析
- [功能状态完整报告](../04_project_management/feature_status.md) - 事件系统实现状态

---

*本文档整合了encounter_events_system.md、events_system_complete.md、landmark_event_patterns.md等3个文档的内容，为开发者提供统一的事件系统参考。*
