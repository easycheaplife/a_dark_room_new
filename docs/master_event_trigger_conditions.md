# å®—å¸ˆäº‹ä»¶è§¦å‘æ¡ä»¶åˆ†æ

## é—®é¢˜
ç”¨æˆ·åæ˜ å®—å¸ˆäº‹ä»¶ä»æœªè§¦å‘è¿‡ï¼Œéœ€è¦åˆ†æè§¦å‘æ¡ä»¶å’Œå¯èƒ½çš„é—®é¢˜ã€‚

## åŸæ¸¸æˆå®—å¸ˆäº‹ä»¶åˆ†æ

### åŸæ¸¸æˆè§¦å‘æ¡ä»¶
æ ¹æ®åŸæ¸¸æˆ `adarkroom/script/events/room.js` ç¬¬525-597è¡Œï¼š

```javascript
{ /* The Wandering Master */
  title: _('The Master'),
  isAvailable: function() {
    return Engine.activeModule == Room && $SM.get('features.location.world');
  },
  // ... äº‹ä»¶å†…å®¹
}
```

**åŸæ¸¸æˆè§¦å‘æ¡ä»¶**ï¼š
1. å½“å‰æ¨¡å—å¿…é¡»æ˜¯ `Room`ï¼ˆå°é»‘å±‹ï¼‰
2. å¿…é¡»å·²è§£é”ä¸–ç•Œåœ°å›¾åŠŸèƒ½ (`features.location.world` = true)

### äº‹ä»¶å†…å®¹
- **æ ‡é¢˜**: "The Master" (å®—å¸ˆ)
- **æè¿°**: ä¸€ä½è€æµæµªè€…åˆ°è¾¾ï¼Œå¾®ç¬‘ç€è¯·æ±‚è¿‡å¤œçš„ä½å®¿
- **æˆæœ¬**: 100è…Œè‚‰ + 100æ¯›çš® + 1ç«æŠŠ
- **å¥–åŠ±**: å¯é€‰æ‹©å­¦ä¹ ä¸‰ç§æŠ€èƒ½ä¹‹ä¸€ï¼š
  - **é—ªé¿** (evasion) - æé«˜æˆ˜æ–—ä¸­çš„é—ªé¿èƒ½åŠ›
  - **ç²¾å‡†** (precision) - æé«˜æ”»å‡»ç²¾åº¦
  - **åŠ›é‡** (force) - æé«˜æ”»å‡»åŠ›

## Flutteré¡¹ç›®å®ç°åˆ†æ

### å½“å‰å®ç°
åœ¨ `lib/events/room_events_extended.dart` ç¬¬537-668è¡Œï¼š

```dart
static Map<String, dynamic> get master => {
  'title': () {
    final localization = Localization();
    return localization.translate('events.room_events.master.title');
  }(),
  'isAvailable': () {
    final fire = _sm.get('game.fire.value', true) ?? 0;
    final worldUnlocked = _sm.get('features.location.world', true) ?? false;
    return fire > 0 && worldUnlocked;
  },
  // ... äº‹ä»¶å†…å®¹
};
```

**Flutteré¡¹ç›®è§¦å‘æ¡ä»¶**ï¼š
1. ç«ç„°å€¼ > 0
2. ä¸–ç•Œåœ°å›¾åŠŸèƒ½å·²è§£é” (`features.location.world` = true)

### é—®é¢˜åˆ†æ

#### 1. è§¦å‘æ¡ä»¶å·®å¼‚
- **åŸæ¸¸æˆ**: åªéœ€è¦åœ¨Roomæ¨¡å—ä¸”ä¸–ç•Œå·²è§£é”
- **Flutteré¡¹ç›®**: éœ€è¦ç«ç„°å€¼>0ä¸”ä¸–ç•Œå·²è§£é”

#### 2. æ¨¡å—æ£€æŸ¥ç¼ºå¤±
Flutteré¡¹ç›®çš„è§¦å‘æ¡ä»¶ä¸­ç¼ºå°‘äº†å¯¹å½“å‰æ¨¡å—çš„æ£€æŸ¥ã€‚åŸæ¸¸æˆæ˜ç¡®è¦æ±‚ `Engine.activeModule == Room`ã€‚

#### 3. äº‹ä»¶æ³¨å†Œæ­£ç¡®
å®—å¸ˆäº‹ä»¶å·²æ­£ç¡®æ³¨å†Œåœ¨ `lib/events/room_events.dart` ç¬¬22è¡Œï¼š
```dart
RoomEventsExtended.master,
```

#### 4. ä¸–ç•Œè§£é”æ—¶æœº
ä¸–ç•Œåœ°å›¾åŠŸèƒ½åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è§£é”ï¼š
- ç©å®¶é¦–æ¬¡å‡ºå‘åˆ°ä¸–ç•Œåœ°å›¾æ—¶ (`lib/modules/path.dart` ç¬¬330è¡Œ)
- ä¸–ç•Œæ¨¡å—åˆå§‹åŒ–æ—¶ (`lib/modules/world.dart` ç¬¬309è¡Œ)

## æ ¹æœ¬åŸå› 

### ä¸»è¦é—®é¢˜ï¼šäº‹ä»¶è§¦å‘é€»è¾‘
åœ¨ `lib/modules/events.dart` ç¬¬804-810è¡Œï¼Œæˆ¿é—´äº‹ä»¶çš„è§¦å‘é€»è¾‘ï¼š

```dart
case 'Room':
  // æˆ¿é—´ä¸­åªè§¦å‘æˆ¿é—´äº‹ä»¶å’Œå…¨å±€äº‹ä»¶ï¼Œä¸è§¦å‘æˆ˜æ–—äº‹ä»¶
  contextEvents = [
    ...RoomEvents.events,
    ...GlobalEvents.events,
  ];
  break;
```

è¿™ä¸ªé€»è¾‘æ˜¯æ­£ç¡®çš„ï¼Œå®—å¸ˆäº‹ä»¶åº”è¯¥èƒ½å¤Ÿåœ¨æˆ¿é—´ä¸­è§¦å‘ã€‚

### å¯èƒ½çš„é—®é¢˜
1. **ä¸–ç•ŒåŠŸèƒ½æœªæ­£ç¡®è§£é”**: ç©å®¶å¯èƒ½è¿˜æ²¡æœ‰è§£é”ä¸–ç•Œåœ°å›¾
2. **ç«ç„°çŠ¶æ€é—®é¢˜**: ç«ç„°å¯èƒ½ç†„ç­äº†
3. **äº‹ä»¶éšæœºæ€§**: äº‹ä»¶è§¦å‘æ˜¯éšæœºçš„ï¼Œå¯èƒ½è¿æ°”ä¸å¥½
4. **äº‹ä»¶å†²çª**: å…¶ä»–äº‹ä»¶å¯èƒ½ä¼˜å…ˆè§¦å‘

## è§£å†³æ–¹æ¡ˆ

### 1. ä¿®å¤è§¦å‘æ¡ä»¶
å°†Flutteré¡¹ç›®çš„è§¦å‘æ¡ä»¶ä¿®æ”¹ä¸ºä¸åŸæ¸¸æˆä¸€è‡´ï¼š

```dart
'isAvailable': () {
  final worldUnlocked = _sm.get('features.location.world', true) ?? false;
  return worldUnlocked; // ç§»é™¤ç«ç„°æ£€æŸ¥ï¼Œä¸åŸæ¸¸æˆä¸€è‡´
},
```

### 2. æ·»åŠ è°ƒè¯•åŠŸèƒ½
æ·»åŠ è°ƒè¯•æ—¥å¿—æ¥è·Ÿè¸ªäº‹ä»¶è§¦å‘ï¼š

```dart
'isAvailable': () {
  final worldUnlocked = _sm.get('features.location.world', true) ?? false;
  Logger.info('ğŸ§™ å®—å¸ˆäº‹ä»¶æ£€æŸ¥ - ä¸–ç•Œå·²è§£é”: $worldUnlocked');
  return worldUnlocked;
},
```

### 3. æ£€æŸ¥ä¸–ç•Œè§£é”çŠ¶æ€
ç©å®¶å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ£€æŸ¥ä¸–ç•Œæ˜¯å¦å·²è§£é”ï¼š
- æŸ¥çœ‹æ˜¯å¦æœ‰"æ¼«æ¼«å°˜é€”"é¡µç­¾
- æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡ºå‘åˆ°ä¸–ç•Œåœ°å›¾

## æµ‹è¯•éªŒè¯

### éªŒè¯æ­¥éª¤
1. ç¡®ä¿ä¸–ç•Œåœ°å›¾å·²è§£é”ï¼ˆæœ‰"æ¼«æ¼«å°˜é€”"é¡µç­¾ï¼‰
2. åœ¨å°é»‘å±‹ä¸­ç­‰å¾…äº‹ä»¶è§¦å‘
3. æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„èµ„æºï¼ˆ100è…Œè‚‰ + 100æ¯›çš® + 1ç«æŠŠï¼‰
4. è§‚å¯Ÿäº‹ä»¶æ—¥å¿—

### é¢„æœŸç»“æœ
ä¿®å¤åï¼Œå®—å¸ˆäº‹ä»¶åº”è¯¥èƒ½å¤Ÿåœ¨ä¸–ç•Œåœ°å›¾è§£é”åçš„å°é»‘å±‹ä¸­éšæœºè§¦å‘ã€‚

## ç›¸å…³æ–‡ä»¶
- `adarkroom/script/events/room.js` - åŸæ¸¸æˆå®—å¸ˆäº‹ä»¶å®ç°
- `lib/events/room_events_extended.dart` - Flutteré¡¹ç›®å®—å¸ˆäº‹ä»¶å®ç°
- `lib/events/room_events.dart` - æˆ¿é—´äº‹ä»¶æ³¨å†Œ
- `lib/modules/events.dart` - äº‹ä»¶è§¦å‘ç³»ç»Ÿ
- `lib/modules/world.dart` - ä¸–ç•ŒåŠŸèƒ½è§£é”é€»è¾‘
- `lib/modules/path.dart` - å‡ºå‘åŠŸèƒ½å’Œä¸–ç•Œè§£é”
